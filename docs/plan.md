# Claude Code ç›‘æ§ç³»ç»Ÿå®ç°è®¡åˆ’
**ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¶é—´**: 2025-10-25
**åŸºäº**: prd.md v1.0
**æ›´æ–°**: 2025-10-25 - é…ç½®æ–‡ä»¶ä» config.json æ”¹ä¸º settings.json

---

## é‡è¦è¯´æ˜

**é…ç½®æ–‡ä»¶ä½ç½®å˜æ›´**ï¼šæœ¬è®¡åˆ’åŸå§‹ç‰ˆæœ¬ä¸­æåˆ°çš„ `~/.claude/config.json` å·²æ›´æ”¹ä¸º `~/.claude/settings.json`ã€‚è¿™æ˜¯ Claude Code çš„å®é™…é…ç½®æ–‡ä»¶ä½ç½®ã€‚install.sh è„šæœ¬ä¼šè‡ªåŠ¨å°† Hooks é…ç½®å†™å…¥ settings.jsonï¼Œæ— éœ€æ‰‹åŠ¨åˆ›å»º config.jsonã€‚

**å½“å‰å®ç°çŠ¶æ€**ï¼ˆ2025-10-27æ›´æ–°ï¼‰ï¼š
- âœ… init.sh: å·²ç®€åŒ–ä¸ºä»…åˆ›å»ºç›®å½•å’Œæ—¥å¿—ï¼ˆæ•°æ®åº“åˆå§‹åŒ–å¾…å®ç°ï¼‰
- âœ… record.sh: å·²å®ç°ï¼Œæ”¯æŒ SessionStart/Stop/UserPromptSubmit/SessionEnd äº‹ä»¶
- âŒ cleanup.sh: å¾…å®ç°
- âœ… query.sh: å·²å®ç°
- âœ… install.sh: å·²å®ç°ï¼Œä½¿ç”¨ Python è‡ªåŠ¨é…ç½® Hooks
- âœ… é€šçŸ¥ç³»ç»Ÿ: ä½¿ç”¨ terminal-notifier æ›¿ä»£ osascript

---

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ—¨åœ¨å¼€å‘ä¸€ä¸ªè½»é‡çº§çš„ Claude Code ç›‘æ§ç³»ç»Ÿï¼Œé€šè¿‡ Claude Hooks æœºåˆ¶å’Œ SQLite æ•°æ®åº“ï¼Œå®ç°å¯¹ Claude Code ä¼šè¯çš„å…¨ç”Ÿå‘½å‘¨æœŸç›‘æ§ã€æ•°æ®è®°å½•å’Œæ™ºèƒ½é€šçŸ¥ã€‚

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- é›¶ä¾µå…¥å¼ç›‘æ§ï¼ˆåŸºäºå®˜æ–¹ Hooksï¼‰
- å®Œæ•´ä¼šè¯è®°å½•ï¼ˆæ—¶é—´ã€æ¶ˆæ¯ã€é¡¹ç›®ä¿¡æ¯ï¼‰
- æ™ºèƒ½é€šçŸ¥ç³»ç»Ÿï¼ˆå®Œæˆæé†’ã€ç»Ÿè®¡ä¿¡æ¯ï¼‰
- å¼‚å¸¸æ£€æµ‹ä¸è‡ªåŠ¨æ¸…ç†
- æ•°æ®æŸ¥è¯¢ä¸å¯¼å‡º

---

## å®æ–½é˜¶æ®µ

### Phase 1: åŸºç¡€è®¾æ–½æ­å»º (ç¬¬1-2å¤©)

#### 1.1 æ•°æ®åº“å±‚å®ç°

**ä»»åŠ¡**: åˆ›å»º `scripts/init.sh` åˆå§‹åŒ–è„šæœ¬

**è¯¦ç»†å†…å®¹**:
- [ ] åˆ›å»ºç›®å½•ç»“æ„ (`~/.claude/scripts`, `logs`, `backups`)
- [ ] å®ç°æ•°æ®åº“è¡¨ç»“æ„
  - [ ] `sessions` è¡¨ï¼šä¼šè¯æ ¸å¿ƒæ•°æ®
    - å­—æ®µï¼šid, session_uuid, start_time, end_time, duration, status, project_name, project_path, pid, terminal_session, created_at, updated_at
    - CHECK çº¦æŸï¼šstatus IN ('running', 'completed', 'terminated')
  - [ ] `messages` è¡¨ï¼šç”¨æˆ·æ¶ˆæ¯è®°å½•
    - å­—æ®µï¼šid, session_id, message_type, content, timestamp
    - å¤–é”®ï¼šsession_id â†’ sessions(id) ON DELETE CASCADE
  - [ ] `events` è¡¨ï¼šäº‹ä»¶æ—¥å¿—
    - å­—æ®µï¼šid, session_id, event_type, event_data (JSON), timestamp
    - å¤–é”®ï¼šsession_id â†’ sessions(id) ON DELETE CASCADE
  - [ ] `statistics` è¡¨ï¼šæ¯æ—¥ç»Ÿè®¡æ±‡æ€»
    - å­—æ®µï¼šid, date, total_sessions, total_duration, avg_duration, completed_count, terminated_count, updated_at
    - UNIQUE çº¦æŸï¼šdate

- [ ] åˆ›å»ºæ•°æ®åº“ç´¢å¼•
  - `idx_sessions_status_time`: (status, start_time)
  - `idx_sessions_project`: (project_name)
  - `idx_messages_session`: (session_id)
  - `idx_events_session_type`: (session_id, event_type)
  - `idx_statistics_date`: (date)

- [ ] åˆ›å»ºè§¦å‘å™¨
  - `update_sessions_timestamp`: è‡ªåŠ¨æ›´æ–° sessions.updated_at

- [ ] åˆ›å»ºè§†å›¾
  - `active_sessions`: ç­›é€‰ status='running' çš„ä¼šè¯
  - `today_stats`: ä»Šæ—¥ç»Ÿè®¡ï¼ˆæ€»ä¼šè¯æ•°ã€å®Œæˆæ•°ã€å¼‚å¸¸æ•°ã€å¹³å‡æ—¶é•¿ã€æ€»æ—¶é•¿ï¼‰

- [ ] ç”Ÿæˆ Hooks é…ç½®æ–‡ä»¶ (`~/.claude/config.json`)
  - SessionStart â†’ `~/.claude/scripts/record.sh start`
  - Stop â†’ `~/.claude/scripts/record.sh stop`
  - Notification â†’ `~/.claude/scripts/record.sh notification`

**éªŒæ”¶æ ‡å‡†**:
- è¿è¡Œ `init.sh` åï¼Œæ•°æ®åº“æ–‡ä»¶åˆ›å»ºæˆåŠŸ
- 4å¼ è¡¨ã€5ä¸ªç´¢å¼•ã€1ä¸ªè§¦å‘å™¨ã€2ä¸ªè§†å›¾åˆ›å»ºæˆåŠŸ
- config.json æ ¼å¼æ­£ç¡®

---

#### 1.2 é¡¹ç›®ç»“æ„æ­å»º

**ä»»åŠ¡**: åˆ›å»ºé¡¹ç›®æ–‡ä»¶ç»“æ„å’Œé…ç½®æ–‡ä»¶

**è¯¦ç»†å†…å®¹**:
- [x] åˆ›å»º `com.claude.monitor.plist` (LaunchAgent é…ç½®)
  - Label: com.claude.monitor
  - ProgramArguments: `/bin/bash ~/.claude/scripts/cleanup.sh`
  - StartInterval: 300 (æ¯5åˆ†é’Ÿ)
  - RunAtLoad: true
  - StandardOutPath/ErrorPath: æ—¥å¿—è·¯å¾„

- [x] åˆ›å»º `install.sh` ä¸»å®‰è£…è„šæœ¬æ¡†æ¶ **ï¼ˆå·²å®Œæˆï¼ŒåŒ…å«è‡ªåŠ¨ Hooks é…ç½®ï¼‰**
  - æ£€æŸ¥ä¾èµ– (sqlite3, osascript, terminal-notifier)
  - è°ƒç”¨ init.sh
  - è®¾ç½®è„šæœ¬æƒé™
  - **ä½¿ç”¨ Python è‡ªåŠ¨é…ç½® Hooks åˆ° ~/.claude/settings.json**
  - æ”¯æŒ SessionStart (startup/resume matcher)
  - å¯é€‰å‚æ•° `--with-daemon` å®‰è£…å®ˆæŠ¤è¿›ç¨‹
  - æ·»åŠ  shell åˆ«ååˆ° ~/.zshrc æˆ– ~/.bashrc

**éªŒæ”¶æ ‡å‡†**:
- plist æ–‡ä»¶æ ¼å¼ç¬¦åˆ macOS LaunchAgent è§„èŒƒ
- install.sh å¯æ‰§è¡Œä¸”é€»è¾‘å®Œæ•´

---

### Phase 2: æ ¸å¿ƒåŠŸèƒ½å¼€å‘ (ç¬¬3-5å¤©)

#### 2.1 äº‹ä»¶è®°å½•è„šæœ¬ (record.sh)

**ä»»åŠ¡**: å®ç°æ ¸å¿ƒäº‹ä»¶è®°å½•é€»è¾‘

**è¯¦ç»†å†…å®¹**:

**2.1.1 è¾…åŠ©å‡½æ•°**
- [ ] `log()`: ç»Ÿä¸€æ—¥å¿—è®°å½•å‡½æ•°
  - æ ¼å¼: `[YYYY-MM-DD HH:MM:SS] message`
  - è¾“å‡ºåˆ°: `~/.claude/logs/monitor.log`

- [ ] `generate_uuid()`: ç”Ÿæˆå”¯ä¸€ä¼šè¯æ ‡è¯†
  - ç®—æ³•: `$(date +%s)-$$-$RANDOM`
  - ç¡®ä¿å”¯ä¸€æ€§

- [ ] `get_project_info()`: è·å–é¡¹ç›®ä¿¡æ¯
  - é¡¹ç›®è·¯å¾„: `$PWD`
  - é¡¹ç›®åç§°: `basename "$PWD"`
  - è¿”å›æ ¼å¼: `name|path`

- [ ] `get_terminal_session()`: è·å–ç»ˆç«¯ä¼šè¯æ ‡è¯†
  - macOS: `$TERM_SESSION_ID`
  - ç”¨äºåŒºåˆ†ä¸åŒç»ˆç«¯çª—å£

- [ ] `get_or_create_session()`: è·å–æˆ–åˆ›å»ºå½“å‰ä¼šè¯
  - æŸ¥æ‰¾æœ€æ–°çš„ running ä¼šè¯
  - ä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°ä¼šè¯
  - è¿”å› session_id

- [ ] `record_message()`: è®°å½•ç”¨æˆ·æ¶ˆæ¯
  - SQL æ³¨å…¥é˜²æŠ¤ï¼šè½¬ä¹‰å•å¼•å· `'` â†’ `''`
  - æ’å…¥ messages è¡¨

- [ ] `record_event()`: è®°å½•äº‹ä»¶
  - æ”¯æŒ JSON æ ¼å¼çš„ event_data
  - æ’å…¥ events è¡¨

**2.1.2 äº‹ä»¶å¤„ç†å™¨**
- [x] **SessionStart å¤„ç†** **ï¼ˆå·²å®Œæˆï¼‰**
  - è°ƒç”¨ `get_or_create_session()`
  - è®°å½• SessionStart äº‹ä»¶ï¼ˆåŒ…å« source ç±»å‹ï¼‰
  - æ”¯æŒ startup å’Œ resume ä¸¤ç§å¯åŠ¨æ–¹å¼
  - å‘é€å¯åŠ¨é€šçŸ¥
  - è®°å½•æ—¥å¿—

- [x] **UserPromptSubmit å¤„ç†** **ï¼ˆæ–°å¢ï¼‰**
  - è·å–å½“å‰ä¼šè¯ ID
  - è®°å½•ç”¨æˆ·æ¶ˆæ¯åˆ° messages è¡¨
  - è®°å½• UserPromptSubmit äº‹ä»¶
  - **æ›´æ–° last_prompt_time å­—æ®µ**ï¼ˆç”¨äºç²¾ç¡®è®¡ç®—å•æ¬¡å¯¹è¯è€—æ—¶ï¼‰
  - è®°å½•æ—¥å¿—

- [x] **Stop å¤„ç†** **ï¼ˆå·²å®Œæˆï¼Œä½¿ç”¨ last_prompt_timeï¼‰**
  - è·å–å½“å‰ä¼šè¯ ID
  - **ä» last_prompt_time è®¡ç®—å•æ¬¡å¯¹è¯è€—æ—¶**ï¼ˆè€Œéä» start_timeï¼‰
  - æ›´æ–°ä¼šè¯çŠ¶æ€ï¼š
    - end_time = datetime('now')
    - duration = è®¡ç®—æ€»æ—¶é•¿ï¼ˆä» start_timeï¼‰
    - status = 'completed'
  - è®°å½• Stop äº‹ä»¶
  - æŸ¥è¯¢ç»Ÿè®¡ä¿¡æ¯ï¼ˆæœ¬æ¬¡æ—¶é•¿ã€é¡¹ç›®åã€ä»Šæ—¥ç»Ÿè®¡ï¼‰
  - æ ¼å¼åŒ–æ—¶é•¿æ˜¾ç¤º
  - **ä½¿ç”¨ terminal-notifier å‘é€é€šçŸ¥**
  - æ›´æ–° statistics è¡¨ï¼ˆINSERT OR REPLACEï¼‰

- [x] **SessionEnd å¤„ç†** **ï¼ˆæ–°å¢ï¼‰**
  - è·å–å½“å‰ä¼šè¯ ID
  - æ£€æŸ¥æ˜¯å¦æœ‰ last_prompt_time
  - å¦‚æœæœ‰ï¼šè®¡ç®—è€—æ—¶å¹¶å‘é€å®Œæˆé€šçŸ¥
  - å¦‚æœæ²¡æœ‰ï¼šé™é»˜æ ‡è®°ä¼šè¯ç»“æŸï¼Œä¸å‘é€é€šçŸ¥
  - è®°å½• SessionEnd äº‹ä»¶

- [x] **Error å¤„ç†** **ï¼ˆå·²å®Œæˆï¼‰**
  - è·å–å½“å‰ä¼šè¯ ID
  - è®°å½• Error äº‹ä»¶
  - æ›´æ–°ä¼šè¯çŠ¶æ€ä¸º 'terminated'
  - è®¡ç®—å¹¶ä¿å­˜æ—¶é•¿
  - å‘é€é”™è¯¯é€šçŸ¥

**éªŒæ”¶æ ‡å‡†**:
- 4ç§äº‹ä»¶å¤„ç†å™¨åŠŸèƒ½å®Œæ•´
- SQL è½¬ä¹‰æ­£ç¡®å¤„ç†ç‰¹æ®Šå­—ç¬¦
- æ—¥å¿—è®°å½•æ¸…æ™°å¯è¿½æº¯
- é”™è¯¯å¤„ç†å¥å£®ï¼ˆset -euo pipefailï¼‰

---

#### 2.2 é€šçŸ¥ç³»ç»Ÿå®ç°

**ä»»åŠ¡**: å®ç° macOS é€šçŸ¥åŠŸèƒ½

**è¯¦ç»†å†…å®¹**:
- [x] **Stop/SessionEnd äº‹ä»¶é€šçŸ¥** **ï¼ˆå·²å®Œæˆï¼Œä½¿ç”¨ terminal-notifierï¼‰**
  - æ ‡é¢˜: "âœ… Claude Code å®Œæˆ"
  - å†…å®¹æ ¼å¼:
    ```
    é¡¹ç›®: {project_name}
    è€—æ—¶: {formatted_duration}ï¼ˆåŸºäº last_prompt_timeï¼‰
    ä»Šæ—¥: ç¬¬{count}æ¬¡, å¹³å‡{avg_duration}
    ```
  - **ä½¿ç”¨ terminal-notifier**ï¼ˆæ¨èï¼‰æˆ–å›é€€åˆ° osascript
  - æ’­æ”¾å£°éŸ³: "Glass"
  - åå°æ‰§è¡Œï¼ˆä½¿ç”¨ &ï¼‰

- [x] **SessionStart äº‹ä»¶é€šçŸ¥** **ï¼ˆæ–°å¢ï¼‰**
  - æ ‡é¢˜: "ğŸš€ Claude Code å¯åŠ¨"
  - å†…å®¹: "é¡¹ç›®: {project_name}"
  - æ’­æ”¾å£°éŸ³: "Blow"

- [x] **Error äº‹ä»¶é€šçŸ¥** **ï¼ˆæ–°å¢ï¼‰**
  - æ ‡é¢˜: "âŒ Claude Code é”™è¯¯"
  - å†…å®¹: é”™è¯¯æ¶ˆæ¯
  - æ’­æ”¾å£°éŸ³: "Funk"

- [x] **æ—¶é•¿æ ¼å¼åŒ–å‡½æ•°** **ï¼ˆå·²å®Œæˆï¼‰**
  - < 60ç§’: "Xç§’"
  - < 3600ç§’: "Xåˆ†Yç§’"
  - >= 3600ç§’: "Xå°æ—¶Yåˆ†"

**éªŒæ”¶æ ‡å‡†**:
- âœ… é€šçŸ¥åœ¨ macOS é€šçŸ¥ä¸­å¿ƒæ­£ç¡®æ˜¾ç¤º
- âœ… æ—¶é•¿æ ¼å¼åŒ–å‡†ç¡®
- âœ… ä½¿ç”¨ terminal-notifier æ—¶æ›´å¯é 
- âœ… å¦‚æœ terminal-notifier ä¸å¯ç”¨ä¼šè®°å½•è­¦å‘Šæ—¥å¿—

---

#### 2.3 å¼‚å¸¸æ¸…ç†è„šæœ¬ (cleanup.sh)

**ä»»åŠ¡**: å®ç°å¼‚å¸¸ä¼šè¯æ£€æµ‹ä¸æ¸…ç†

**å½“å‰çŠ¶æ€**: âŒ **å¾…å®ç°**ï¼ˆscripts/cleanup.sh æ–‡ä»¶ä¸å­˜åœ¨ï¼‰

**è¯¦ç»†å†…å®¹**:
- [ ] `cleanup_abnormal_sessions()`: æ¸…ç†å¼‚å¸¸ä¼šè¯
  - æŸ¥è¯¢æ‰€æœ‰ status='running' çš„ä¼šè¯
  - ä½¿ç”¨ `kill -0 $pid` æ£€æµ‹è¿›ç¨‹æ˜¯å¦å­˜åœ¨
  - è¿›ç¨‹ä¸å­˜åœ¨åˆ™ï¼š
    - æ›´æ–°çŠ¶æ€ä¸º 'terminated'
    - è®¡ç®—å¹¶ä¿å­˜æ—¶é•¿
    - è®°å½• AbnormalTermination äº‹ä»¶
  - æ—¥å¿—è®°å½•æ¯ä¸ªæ¸…ç†æ“ä½œ

- [ ] `cleanup_timeout_sessions()`: æ¸…ç†è¶…æ—¶ä¼šè¯
  - æŸ¥æ‰¾ running çŠ¶æ€ä¸”å¼€å§‹æ—¶é—´ > 24å°æ—¶çš„ä¼šè¯
  - æ ‡è®°ä¸º 'terminated'
  - è®°å½•æ—¥å¿—

- [ ] `main()`: ä¸»å‡½æ•°
  - æ‰§è¡Œå¼‚å¸¸ä¼šè¯æ¸…ç†
  - æ‰§è¡Œè¶…æ—¶ä¼šè¯æ¸…ç†
  - æ‰§è¡Œæ•°æ®åº“ç»´æŠ¤ (VACUUM)
  - è®°å½•å¼€å§‹/å®Œæˆæ—¥å¿—

**éªŒæ”¶æ ‡å‡†**:
- èƒ½æ­£ç¡®æ£€æµ‹å·²ç»ˆæ­¢çš„è¿›ç¨‹
- è¶…æ—¶ä¼šè¯ï¼ˆ>24hï¼‰è¢«è‡ªåŠ¨æ¸…ç†
- VACUUM æ‰§è¡Œåæ•°æ®åº“æ–‡ä»¶å¤§å°ä¼˜åŒ–
- æ—¥å¿—è®°å½•è¯¦ç»†

**æ³¨æ„**: å½“å‰è¯¥è„šæœ¬ç¼ºå¤±ï¼ŒLaunchAgent å®ˆæŠ¤è¿›ç¨‹æ— æ³•æ­£å¸¸å·¥ä½œ

---

### Phase 3: æŸ¥è¯¢å·¥å…·å¼€å‘ (ç¬¬6-7å¤©)

#### 3.1 æŸ¥è¯¢è„šæœ¬ (query.sh)

**ä»»åŠ¡**: å®ç°æ•°æ®æŸ¥è¯¢ä¸å¯¼å‡ºåŠŸèƒ½

**è¯¦ç»†å†…å®¹**:

- [ ] **today å‘½ä»¤**: æ˜¾ç¤ºä»Šæ—¥ä¼šè¯åˆ—è¡¨
  - å­—æ®µï¼šå¼€å§‹æ—¶é—´(HH:MM)ã€è€—æ—¶ã€çŠ¶æ€ã€é¡¹ç›®å
  - è€—æ—¶æ ¼å¼åŒ–ï¼š<60sæ˜¾ç¤ºç§’ï¼Œ<3600æ˜¾ç¤ºåˆ†ç§’ï¼Œå¦åˆ™æ˜¾ç¤ºå°æ—¶åˆ†é’Ÿ
  - åˆ—å®½è®¾ç½®ï¼š.width 8 20 10 10 30
  - æŒ‰å¼€å§‹æ—¶é—´é™åºæ’åº

- [ ] **stats å‘½ä»¤**: æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
  - ä»Šæ—¥ä¼šè¯æ•°
  - ä»Šæ—¥å®Œæˆæ•°
  - ä»Šæ—¥æ€»æ—¶é•¿ï¼ˆå°æ—¶ï¼Œä¿ç•™2ä½å°æ•°ï¼‰
  - å¹³å‡æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼Œä¿ç•™1ä½å°æ•°ï¼‰
  - æœ¬å‘¨æ€»ä¼šè¯æ•°
  - æœ¬å‘¨æ€»æ—¶é•¿ï¼ˆå°æ—¶ï¼‰
  - ä½¿ç”¨ `.mode line` æ ¼å¼åŒ–è¾“å‡º

- [ ] **active å‘½ä»¤**: æ˜¾ç¤ºæ´»è·ƒä¼šè¯
  - å­—æ®µï¼šid, å¼€å§‹æ—¶é—´, é¡¹ç›®å, å·²è¿è¡Œæ—¶é•¿ï¼ˆç§’ï¼‰
  - å®æ—¶è®¡ç®—å·²è¿è¡Œæ—¶é•¿
  - æŒ‰å¼€å§‹æ—¶é—´é™åºæ’åº

- [ ] **messages å‘½ä»¤**: æ˜¾ç¤ºæ¶ˆæ¯è®°å½•
  - æ— å‚æ•°ï¼šæ˜¾ç¤ºæœ€è¿‘10æ¡æ¶ˆæ¯ï¼ˆæ‰€æœ‰ä¼šè¯ï¼‰
  - å¸¦ session_idï¼šæ˜¾ç¤ºç‰¹å®šä¼šè¯çš„æ‰€æœ‰æ¶ˆæ¯
  - å­—æ®µï¼šæ—¶é—´ã€æ¶ˆæ¯å†…å®¹ï¼ˆæˆªæ–­å¤„ç†ï¼‰

- [ ] **export å‘½ä»¤**: å¯¼å‡ºæ•°æ®
  - CSV æ ¼å¼ï¼šä½¿ç”¨ sqlite3 -csv æ¨¡å¼
  - JSON æ ¼å¼ï¼šä½¿ç”¨ json_group_array + json_object
  - è¾“å‡ºæ–‡ä»¶åï¼š`~/claude_export_YYYYMMDD_HHMMSS.{csv|json}`
  - å¯¼å‡ºå­—æ®µï¼šsession_uuid, start_time, end_time, duration, status, project_name, project_path

- [ ] **clean å‘½ä»¤**: æ¸…ç†å†å²æ•°æ®
  - å‚æ•°ï¼šå¤©æ•°ï¼ˆé»˜è®¤30å¤©ï¼‰
  - åˆ é™¤è¶…è¿‡æŒ‡å®šå¤©æ•°çš„ sessions
  - çº§è”åˆ é™¤å…³è”çš„ messages å’Œ events
  - æ‰§è¡Œ VACUUM
  - æ˜¾ç¤ºåˆ é™¤æ•°é‡

- [ ] **help å‘½ä»¤**: å¸®åŠ©ä¿¡æ¯
  - åˆ—å‡ºæ‰€æœ‰å¯ç”¨å‘½ä»¤
  - æ¯ä¸ªå‘½ä»¤çš„å‚æ•°è¯´æ˜

**3.1.2 å½©è‰²è¾“å‡º**
- [ ] å®šä¹‰é¢œè‰²å¸¸é‡ï¼ˆRED, GREEN, BLUE, YELLOW, NCï¼‰
- [ ] ä¸ºä¸åŒå‘½ä»¤è¾“å‡ºä½¿ç”¨ä¸åŒé¢œè‰²
- [ ] æˆåŠŸæ¶ˆæ¯ï¼šç»¿è‰²
- [ ] è­¦å‘Šæ¶ˆæ¯ï¼šé»„è‰²
- [ ] é”™è¯¯æ¶ˆæ¯ï¼šçº¢è‰²
- [ ] æ ‡é¢˜ï¼šè“è‰²

**éªŒæ”¶æ ‡å‡†**:
- 7ä¸ªå‘½ä»¤å…¨éƒ¨åŠŸèƒ½æ­£å¸¸
- è¾“å‡ºæ ¼å¼ç¾è§‚ã€æ˜“è¯»
- CSV/JSON å¯¼å‡ºæ ¼å¼æ­£ç¡®
- å½©è‰²è¾“å‡ºåœ¨ç»ˆç«¯æ­£ç¡®æ˜¾ç¤º

---

### Phase 4: å®ˆæŠ¤è¿›ç¨‹ä¸å®‰è£… (ç¬¬8å¤©)

#### 4.1 LaunchAgent å®Œå–„

**ä»»åŠ¡**: å®Œæˆå®ˆæŠ¤è¿›ç¨‹é…ç½®

**è¯¦ç»†å†…å®¹**:
- [ ] éªŒè¯ plist æ–‡ä»¶æ ¼å¼
- [ ] æµ‹è¯• launchctl load/unload
- [ ] éªŒè¯å®šæ—¶æ‰§è¡Œï¼ˆæ¯5åˆ†é’Ÿï¼‰
- [ ] éªŒè¯æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šè·¯å¾„
- [ ] æµ‹è¯•å¼€æœºè‡ªå¯åŠ¨ï¼ˆRunAtLoadï¼‰

**éªŒæ”¶æ ‡å‡†**:
- launchctl load æ— é”™è¯¯
- cleanup.sh æ¯5åˆ†é’Ÿè‡ªåŠ¨æ‰§è¡Œ
- æ—¥å¿—æ­£å¸¸å†™å…¥ daemon.log

---

#### 4.2 å®‰è£…è„šæœ¬å®Œå–„

**ä»»åŠ¡**: å®Œæˆ install.sh å®ç°

**è¯¦ç»†å†…å®¹**:
- [ ] ä¾èµ–æ£€æŸ¥
  - æ£€æŸ¥ sqlite3 æ˜¯å¦å®‰è£…
  - æ£€æŸ¥ osascript æ˜¯å¦å¯ç”¨ï¼ˆmacOSï¼‰
  - æ£€æŸ¥ ~/.zshrc æ˜¯å¦å­˜åœ¨

- [ ] å®‰è£…æµç¨‹
  - æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
  - æ‰§è¡Œ init.sh åˆå§‹åŒ–æ•°æ®åº“
  - è®¾ç½®æ‰€æœ‰è„šæœ¬ä¸ºå¯æ‰§è¡Œï¼ˆchmod +xï¼‰
  - å¦‚æœå¸¦ `--with-daemon` å‚æ•°ï¼š
    - å¤åˆ¶ plist åˆ° ~/Library/LaunchAgents/
    - æ‰§è¡Œ launchctl load
  - æ·»åŠ  shell åˆ«ååˆ° ~/.zshrc

- [ ] æ·»åŠ çš„åˆ«å
  ```bash
  alias claude-stats='~/.claude/scripts/query.sh stats'
  alias claude-today='~/.claude/scripts/query.sh today'
  alias claude-clean='~/.claude/scripts/cleanup.sh'
  ```

- [ ] å®‰è£…åæç¤º
  - æ˜¾ç¤ºå®‰è£…æˆåŠŸä¿¡æ¯
  - æç¤ºç”¨æˆ·æ‰‹åŠ¨é…ç½® Claude Code Hooks
  - æç¤ºé‡å¯ç»ˆç«¯æˆ– source ~/.zshrc
  - æ˜¾ç¤ºä½¿ç”¨ç¤ºä¾‹

**éªŒæ”¶æ ‡å‡†**:
- å®‰è£…è¿‡ç¨‹æ— é”™è¯¯
- æ‰€æœ‰è„šæœ¬æƒé™æ­£ç¡®
- åˆ«åæ·»åŠ æˆåŠŸ
- å®ˆæŠ¤è¿›ç¨‹ï¼ˆå¯é€‰ï¼‰æ­£å¸¸è¿è¡Œ

---

#### 4.3 å¸è½½è„šæœ¬

**ä»»åŠ¡**: åˆ›å»º uninstall.sh

**è¯¦ç»†å†…å®¹**:
- [ ] åœæ­¢å¹¶å¸è½½ LaunchAgent
  ```bash
  launchctl unload ~/Library/LaunchAgents/com.claude.monitor.plist
  rm ~/Library/LaunchAgents/com.claude.monitor.plist
  ```

- [ ] è¯¢é—®æ˜¯å¦ä¿ç•™æ•°æ®
  - ä¿ç•™ï¼šä»…åˆ é™¤è„šæœ¬å’Œé…ç½®
  - ä¸ä¿ç•™ï¼šåˆ é™¤æ•´ä¸ª ~/.claude ç›®å½•

- [ ] ä» ~/.zshrc ç§»é™¤åˆ«å
  - ä½¿ç”¨ sed æˆ– grep -v åˆ é™¤ç›¸å…³è¡Œ

- [ ] æ˜¾ç¤ºå¸è½½å®Œæˆä¿¡æ¯

**éªŒæ”¶æ ‡å‡†**:
- å®ˆæŠ¤è¿›ç¨‹å®Œå…¨åœæ­¢
- è„šæœ¬å’Œé…ç½®æ–‡ä»¶åˆ é™¤
- åˆ«åä» shell é…ç½®ä¸­ç§»é™¤
- å¯é€‰ä¿ç•™æ•°æ®åº“æ–‡ä»¶

---

### Phase 5: æµ‹è¯•éªŒè¯ (ç¬¬9-10å¤©)

#### 5.1 å•å…ƒæµ‹è¯•

**ä»»åŠ¡**: åˆ›å»º test.sh æµ‹è¯•è„šæœ¬

**è¯¦ç»†å†…å®¹**:
- [ ] æµ‹è¯•æ¡†æ¶æ­å»º
  - `assert_equal()`: ç›¸ç­‰æ–­è¨€
  - `assert_not_empty()`: éç©ºæ–­è¨€
  - `assert_greater()`: å¤§äºæ–­è¨€
  - æµ‹è¯•ç»“æœç»Ÿè®¡

- [ ] æ•°æ®åº“æµ‹è¯•
  - [ ] `test_db_connection()`: æ•°æ®åº“è¿æ¥
  - [ ] `test_table_creation()`: è¡¨ç»“æ„åˆ›å»º
  - [ ] `test_index_creation()`: ç´¢å¼•åˆ›å»º
  - [ ] `test_trigger_function()`: è§¦å‘å™¨åŠŸèƒ½
  - [ ] `test_view_creation()`: è§†å›¾åˆ›å»º

- [ ] ä¼šè¯ç®¡ç†æµ‹è¯•
  - [ ] `test_session_creation()`: ä¼šè¯åˆ›å»º
  - [ ] `test_session_update()`: ä¼šè¯æ›´æ–°
  - [ ] `test_session_termination()`: ä¼šè¯ç»ˆæ­¢
  - [ ] `test_duration_calculation()`: æ—¶é•¿è®¡ç®—

- [ ] æ¶ˆæ¯è®°å½•æµ‹è¯•
  - [ ] `test_message_insert()`: æ¶ˆæ¯æ’å…¥
  - [ ] `test_special_characters()`: ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰
  - [ ] `test_empty_message()`: ç©ºæ¶ˆæ¯å¤„ç†

- [ ] æ¸…ç†åŠŸèƒ½æµ‹è¯•
  - [ ] `test_cleanup_abnormal()`: å¼‚å¸¸ä¼šè¯æ¸…ç†
  - [ ] `test_cleanup_timeout()`: è¶…æ—¶ä¼šè¯æ¸…ç†
  - [ ] `test_vacuum()`: æ•°æ®åº“ç»´æŠ¤

- [ ] æŸ¥è¯¢åŠŸèƒ½æµ‹è¯•
  - [ ] `test_query_today()`: ä»Šæ—¥æŸ¥è¯¢
  - [ ] `test_query_stats()`: ç»Ÿè®¡æŸ¥è¯¢
  - [ ] `test_export_csv()`: CSV å¯¼å‡º
  - [ ] `test_export_json()`: JSON å¯¼å‡º

**éªŒæ”¶æ ‡å‡†**:
- æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
- æµ‹è¯•è¦†ç›–ç‡ > 80%
- è¾¹ç•Œæ¡ä»¶æµ‹è¯•å……åˆ†

---

#### 5.2 é›†æˆæµ‹è¯•

**ä»»åŠ¡**: å®Œæ•´æµç¨‹æµ‹è¯•

**è¯¦ç»†å†…å®¹**:
- [ ] **æ­£å¸¸æµç¨‹æµ‹è¯•**
  - æ¨¡æ‹Ÿ SessionStart Hook
  - ç­‰å¾…ä¸€æ®µæ—¶é—´
  - æ¨¡æ‹Ÿ Stop Hook
  - éªŒè¯ï¼š
    - æ•°æ®åº“ä¸­ä¼šè¯çŠ¶æ€ä¸º 'completed'
    - æ—¶é•¿è®¡ç®—æ­£ç¡®
    - é€šçŸ¥å‘é€æˆåŠŸ
    - statistics è¡¨æ›´æ–°

- [ ] **å¼‚å¸¸é€€å‡ºæµ‹è¯•**
  - å¯åŠ¨ä¼šè¯
  - æ¨¡æ‹Ÿè¿›ç¨‹å¼‚å¸¸ç»ˆæ­¢ï¼ˆkill -9ï¼‰
  - è¿è¡Œ cleanup.sh
  - éªŒè¯ï¼š
    - ä¼šè¯çŠ¶æ€ä¸º 'terminated'
    - è®°å½• AbnormalTermination äº‹ä»¶

- [ ] **ç»ˆç«¯å…³é—­æµ‹è¯•**
  - å¯åŠ¨ä¼šè¯åå…³é—­ç»ˆç«¯
  - ç­‰å¾…å®ˆæŠ¤è¿›ç¨‹è¿è¡Œï¼ˆ5åˆ†é’Ÿï¼‰
  - éªŒè¯ï¼š
    - ä¼šè¯è¢«è‡ªåŠ¨æ ‡è®°ä¸º terminated

- [ ] **å¹¶å‘ä¼šè¯æµ‹è¯•**
  - åœ¨å¤šä¸ªç»ˆç«¯åŒæ—¶å¯åŠ¨ Claude Code
  - éªŒè¯ï¼š
    - æ¯ä¸ªç»ˆç«¯æœ‰ç‹¬ç«‹çš„ä¼šè¯è®°å½•
    - æ•°æ®ä¸å†²çª

- [ ] **Notification æµ‹è¯•**
  - æ¨¡æ‹Ÿ Notification Hook
  - éªŒè¯ï¼š
    - ç³»ç»Ÿé€šçŸ¥æ˜¾ç¤º
    - ç»ˆç«¯çª—å£æ¿€æ´»
    - äº‹ä»¶è®°å½•åˆ°æ•°æ®åº“

**éªŒæ”¶æ ‡å‡†**:
- æ‰€æœ‰é›†æˆæµ‹è¯•åœºæ™¯é€šè¿‡
- æ— æ•°æ®ç«äº‰æˆ–æ­»é”
- é€šçŸ¥ç³»ç»Ÿæ­£å¸¸å·¥ä½œ

---

#### 5.3 æ€§èƒ½æµ‹è¯•

**ä»»åŠ¡**: éªŒè¯æ€§èƒ½æŒ‡æ ‡

**è¯¦ç»†å†…å®¹**:
- [ ] **Hook æ‰§è¡Œæ—¶é—´æµ‹è¯•**
  - æµ‹é‡æ¯ä¸ª Hook çš„æ‰§è¡Œæ—¶é—´
  - ç›®æ ‡ï¼š< 50ms
  - ä½¿ç”¨ `time` å‘½ä»¤æµ‹é‡

- [ ] **æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½**
  - æµ‹è¯•å¸¸ç”¨æŸ¥è¯¢ï¼ˆtoday, stats, activeï¼‰
  - ç›®æ ‡ï¼š< 10ms
  - ä½¿ç”¨ EXPLAIN QUERY PLAN åˆ†æ

- [ ] **é€šçŸ¥å»¶è¿Ÿæµ‹è¯•**
  - æµ‹é‡ Stop äº‹ä»¶åˆ°é€šçŸ¥æ˜¾ç¤ºçš„æ—¶é—´
  - ç›®æ ‡ï¼š< 100ms

- [ ] **å†…å­˜å ç”¨æµ‹è¯•**
  - æµ‹é‡è„šæœ¬è¿è¡Œæ—¶å†…å­˜ä½¿ç”¨
  - ç›®æ ‡ï¼š< 5MB

- [ ] **æ•°æ®åº“å¤§å°æµ‹è¯•**
  - æ¨¡æ‹Ÿ1å¹´æ•°æ®ï¼ˆæ¯å¤©10ä¸ªä¼šè¯ï¼‰
  - ç›®æ ‡ï¼š< 10MB

**éªŒæ”¶æ ‡å‡†**:
- æ‰€æœ‰æ€§èƒ½æŒ‡æ ‡è¾¾åˆ°ç›®æ ‡
- åœ¨å¤§é‡æ•°æ®ä¸‹æ€§èƒ½ç¨³å®š

---

#### 5.4 è¾¹ç•Œæµ‹è¯•

**ä»»åŠ¡**: æµ‹è¯•è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µ

**è¯¦ç»†å†…å®¹**:
- [ ] ç‰¹æ®Šå­—ç¬¦æµ‹è¯•
  - æ¶ˆæ¯åŒ…å«å•å¼•å·ã€åŒå¼•å·
  - æ¶ˆæ¯åŒ…å«æ¢è¡Œç¬¦
  - æ¶ˆæ¯åŒ…å« SQL å…³é”®å­—

- [ ] ç©ºå€¼æµ‹è¯•
  - ç©ºæ¶ˆæ¯
  - ç©ºé¡¹ç›®åç§°
  - NULL å€¼å¤„ç†

- [ ] æ•°æ®åº“é”å®šæµ‹è¯•
  - å¤šä¸ªè„šæœ¬åŒæ—¶å†™å…¥
  - VACUUM æœŸé—´çš„æŸ¥è¯¢

- [ ] å¤§æ•°æ®é‡æµ‹è¯•
  - å•ä¸ªä¼šè¯åŒ…å«å¤§é‡æ¶ˆæ¯
  - å•æ—¥åŒ…å«å¤§é‡ä¼šè¯

- [ ] ç³»ç»Ÿèµ„æºé™åˆ¶æµ‹è¯•
  - ç£ç›˜ç©ºé—´ä¸è¶³
  - æƒé™ä¸è¶³

**éªŒæ”¶æ ‡å‡†**:
- æ‰€æœ‰è¾¹ç•Œæƒ…å†µæ­£ç¡®å¤„ç†
- é”™è¯¯æ¶ˆæ¯æ¸…æ™°å‹å¥½
- ä¸ä¼šå¯¼è‡´æ•°æ®æŸå

---

### Phase 6: æ–‡æ¡£ä¸ä¼˜åŒ– (ç¬¬11å¤©)

#### 6.1 æ–‡æ¡£å®Œå–„

**ä»»åŠ¡**: åˆ›å»ºç”¨æˆ·æ–‡æ¡£

**è¯¦ç»†å†…å®¹**:
- [ ] **README.md**
  - é¡¹ç›®ä»‹ç»
  - åŠŸèƒ½ç‰¹æ€§
  - å¿«é€Ÿå¼€å§‹
  - ä½¿ç”¨ç¤ºä¾‹
  - å¸¸è§é—®é¢˜
  - å¸è½½è¯´æ˜

- [ ] **INSTALL.md**
  - ç³»ç»Ÿè¦æ±‚
  - ä¾èµ–æ£€æŸ¥
  - å®‰è£…æ­¥éª¤
  - Claude Code Hooks é…ç½®
  - å®ˆæŠ¤è¿›ç¨‹é…ç½®ï¼ˆå¯é€‰ï¼‰
  - æ•…éšœæ’æŸ¥

- [ ] **ä»£ç æ³¨é‡Šå®Œå–„**
  - æ¯ä¸ªå‡½æ•°æ·»åŠ æ³¨é‡Šè¯´æ˜
  - å…³é”®é€»è¾‘æ·»åŠ è¡Œå†…æ³¨é‡Š
  - SQL è¯­å¥æ·»åŠ æ³¨é‡Š

- [ ] **ç¤ºä¾‹é…ç½®æ–‡ä»¶**
  - hooks.json ç¤ºä¾‹
  - .zshrc é…ç½®ç¤ºä¾‹

**éªŒæ”¶æ ‡å‡†**:
- æ–‡æ¡£æ¸…æ™°æ˜“æ‡‚
- æ­¥éª¤å®Œæ•´å¯å¤ç°
- ç¤ºä¾‹ä»£ç æ­£ç¡®

---

#### 6.2 æ€§èƒ½ä¼˜åŒ–

**ä»»åŠ¡**: æ ¹æ®æµ‹è¯•ç»“æœä¼˜åŒ–æ€§èƒ½

**è¯¦ç»†å†…å®¹**:
- [ ] **SQL ä¼˜åŒ–**
  - åˆ†ææ…¢æŸ¥è¯¢
  - ä¼˜åŒ–ç´¢å¼•ä½¿ç”¨
  - é¿å…å…¨è¡¨æ‰«æ

- [ ] **è„šæœ¬ä¼˜åŒ–**
  - å‡å°‘å­è¿›ç¨‹è°ƒç”¨
  - ä¼˜åŒ–å­—ç¬¦ä¸²å¤„ç†
  - å‡å°‘é‡å¤æŸ¥è¯¢

- [ ] **é€šçŸ¥ä¼˜åŒ–**
  - è€ƒè™‘å¼‚æ­¥å‘é€é€šçŸ¥ï¼ˆå¦‚æœéœ€è¦ï¼‰
  - å‡å°‘ osascript è°ƒç”¨æ¬¡æ•°

- [ ] **æ—¥å¿—ä¼˜åŒ–**
  - æ—¥å¿—è½®è½¬æœºåˆ¶
  - é™åˆ¶æ—¥å¿—æ–‡ä»¶å¤§å°

**éªŒæ”¶æ ‡å‡†**:
- Hook æ‰§è¡Œæ—¶é—´ < 50ms
- æ•°æ®åº“æŸ¥è¯¢ < 10ms
- é€šçŸ¥å»¶è¿Ÿ < 100ms

---

#### 6.3 ä»£ç å®¡æŸ¥ä¸é‡æ„

**ä»»åŠ¡**: ä»£ç è´¨é‡æå‡

**è¯¦ç»†å†…å®¹**:
- [ ] ä»£ç è§„èŒƒæ£€æŸ¥
  - ç»Ÿä¸€ç¼©è¿›ï¼ˆ4ç©ºæ ¼ï¼‰
  - ç»Ÿä¸€å¼•å·ä½¿ç”¨
  - å‡½æ•°å‘½åè§„èŒƒ

- [ ] é”™è¯¯å¤„ç†æ”¹è¿›
  - æ‰€æœ‰è„šæœ¬ä½¿ç”¨ `set -euo pipefail`
  - æ·»åŠ é”™è¯¯ä¿¡æ¯è¾“å‡º
  - å¼‚å¸¸æƒ…å†µä¼˜é›…å¤„ç†

- [ ] å®‰å…¨æ€§æ£€æŸ¥
  - SQL æ³¨å…¥é˜²æŠ¤
  - è·¯å¾„éå†é˜²æŠ¤
  - æƒé™æ£€æŸ¥

- [ ] å¯ç»´æŠ¤æ€§æ”¹è¿›
  - æå–å¸¸é‡é…ç½®
  - å‡½æ•°æ¨¡å—åŒ–
  - å‡å°‘ä»£ç é‡å¤

**éªŒæ”¶æ ‡å‡†**:
- æ—  shellcheck è­¦å‘Š
- å®‰å…¨æ‰«ææ— é—®é¢˜
- ä»£ç å¯è¯»æ€§è‰¯å¥½

---

## äº¤ä»˜ç‰©æ¸…å•

### æ ¸å¿ƒè„šæœ¬ (6ä¸ª)
- [x] `scripts/init.sh` - æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ **ï¼ˆç®€åŒ–ç‰ˆï¼Œä»…åˆ›å»ºç›®å½•ï¼‰**
- [x] `scripts/record.sh` - äº‹ä»¶è®°å½•è„šæœ¬ **ï¼ˆå·²å®Œæˆï¼Œæ”¯æŒ 4 ç§äº‹ä»¶ï¼‰**
- [ ] `scripts/cleanup.sh` - å¼‚å¸¸æ¸…ç†è„šæœ¬ **ï¼ˆå¾…å®ç°ï¼‰**
- [x] `scripts/query.sh` - æŸ¥è¯¢å·¥å…·è„šæœ¬ **ï¼ˆå·²å®Œæˆï¼‰**
- [x] `install.sh` - å®‰è£…è„šæœ¬ **ï¼ˆå·²å®Œæˆï¼Œè‡ªåŠ¨é…ç½® Hooksï¼‰**
- [ ] `uninstall.sh` - å¸è½½è„šæœ¬ **ï¼ˆå¾…éªŒè¯ï¼‰**

### é…ç½®æ–‡ä»¶ (1ä¸ª)
- [ ] `com.claude.monitor.plist` - LaunchAgent é…ç½®

### æµ‹è¯•è„šæœ¬ (1ä¸ª)
- [ ] `test.sh` - è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

### æ–‡æ¡£ (4ä¸ª)
- [ ] `plan.md` - å®æ–½è®¡åˆ’ï¼ˆæœ¬æ–‡æ¡£ï¼‰
- [ ] `README.md` - ç”¨æˆ·ä½¿ç”¨æŒ‡å—
- [ ] `INSTALL.md` - å®‰è£…è¯´æ˜
- [ ] `CLAUDE.md` - Claude Code æŒ‡å—ï¼ˆå·²åˆ›å»ºï¼‰

---

## æŠ€æœ¯è¦ç‚¹æ€»ç»“

### 1. æ•°æ®åº“è®¾è®¡
- **4è¡¨ç»“æ„**: sessions, messages, events, statistics
- **sessions è¡¨æ–°å¢å­—æ®µ**: `last_prompt_time` DATETIMEï¼ˆç”¨äºç²¾ç¡®è®¡ç®—å•æ¬¡å¯¹è¯è€—æ—¶ï¼‰
- **5ä¸ªç´¢å¼•**: ä¼˜åŒ–å¸¸ç”¨æŸ¥è¯¢ï¼ˆstatus_time, project, session_idç­‰ï¼‰
- **1ä¸ªè§¦å‘å™¨**: è‡ªåŠ¨æ›´æ–° updated_at
- **2ä¸ªè§†å›¾**: active_sessions, today_stats
- **å½“å‰çŠ¶æ€**: âŒ æ•°æ®åº“æ–‡ä»¶ä¸ºç©ºï¼Œéœ€è¦é‡æ–°å®ç° init.sh çš„æ•°æ®åº“åˆå§‹åŒ–é€»è¾‘

### 2. å¼‚å¸¸å¤„ç†
- **è¿›ç¨‹æ£€æµ‹**: ä½¿ç”¨ `kill -0 $pid` æ£€æµ‹è¿›ç¨‹å­˜æ´»
- **è¶…æ—¶æ¸…ç†**: è‡ªåŠ¨æ¸…ç†è¿è¡Œè¶…è¿‡24å°æ—¶çš„ä¼šè¯
- **å®ˆæŠ¤è¿›ç¨‹**: LaunchAgent æ¯5åˆ†é’Ÿæ‰§è¡Œæ¸…ç†

### 3. é€šçŸ¥ç³»ç»Ÿ
- **macOS é›†æˆ**: ä½¿ç”¨ terminal-notifierï¼ˆæ¨èï¼‰æˆ– osascriptï¼ˆå¤‡é€‰ï¼‰
- **æ™ºèƒ½ç»Ÿè®¡**: æ˜¾ç¤ºä»Šæ—¥ä¼šè¯æ¬¡æ•°å’Œå¹³å‡æ—¶é•¿
- **ç²¾ç¡®è€—æ—¶**: åŸºäº last_prompt_time è®¡ç®—å•æ¬¡å¯¹è¯è€—æ—¶
- **å¤šç§é€šçŸ¥**: å¯åŠ¨ã€å®Œæˆã€é”™è¯¯ä¸‰ç§é€šçŸ¥ç±»å‹
- **åå°æ‰§è¡Œ**: ä½¿ç”¨ & ç¡®ä¿ä¸é˜»å¡ Hook æ‰§è¡Œ

### 4. ä¼šè¯ç®¡ç†
- **UUID ç”Ÿæˆ**: `$(date +%s)-$$-$RANDOM` ç¡®ä¿å”¯ä¸€æ€§ï¼Œæˆ–ä½¿ç”¨ Hook ä¼ å…¥çš„ session_id
- **çŠ¶æ€æœº**: running â†’ completed/terminated
- **æ—¶é•¿è®¡ç®—**:
  - æ€»æ—¶é•¿: ä» start_time åˆ° end_time
  - å•æ¬¡å¯¹è¯è€—æ—¶: ä» last_prompt_time åˆ° stop/session_end
  - ä½¿ç”¨ SQLite julianday å‡½æ•°è®¡ç®—ç§’æ•°
- **äº‹ä»¶ç±»å‹**: SessionStart (startup/resume), UserPromptSubmit, Stop, SessionEnd, Error

### 5. æ€§èƒ½ç›®æ ‡
- **Hook æ‰§è¡Œ**: < 50ms
- **æ•°æ®åº“æŸ¥è¯¢**: < 10ms
- **é€šçŸ¥å»¶è¿Ÿ**: < 100ms
- **å†…å­˜å ç”¨**: < 5MB
- **æ•°æ®åº“å¤§å°**: < 10MB (1å¹´æ•°æ®)

---

## é£é™©ä¸å¯¹ç­–

### é£é™©1: Hook æ‰§è¡Œè¶…æ—¶
**å½±å“**: é˜»å¡ Claude Codeï¼Œå½±å“ç”¨æˆ·ä½“éªŒ
**å¯¹ç­–**:
- ä¼˜åŒ– SQL æŸ¥è¯¢ï¼Œä½¿ç”¨ç´¢å¼•
- è€ƒè™‘å¼‚æ­¥å¤„ç†é€šçŸ¥
- é™åˆ¶æ—¥å¿—å†™å…¥æ“ä½œ

### é£é™©2: æ•°æ®åº“æŸå
**å½±å“**: å†å²æ•°æ®ä¸¢å¤±
**å¯¹ç­–**:
- å®šæœŸå¤‡ä»½ï¼ˆæ¯å¤©/æ¯å‘¨ï¼‰
- ä½¿ç”¨äº‹åŠ¡ä¿è¯åŸå­æ€§
- æä¾›æ•°æ®å¯¼å‡ºåŠŸèƒ½

### é£é™©3: è¿›ç¨‹æ£€æµ‹è¯¯åˆ¤
**å½±å“**: æ­£å¸¸ä¼šè¯è¢«æ ‡è®°ä¸ºå¼‚å¸¸
**å¯¹ç­–**:
- ä½¿ç”¨å¯é çš„è¿›ç¨‹æ£€æµ‹æ–¹æ³• (`kill -0`)
- 24å°æ—¶è¶…æ—¶ä½œä¸ºå…œåº•
- è®°å½•è¯¦ç»†æ—¥å¿—ä¾¿äºæ’æŸ¥

### é£é™©4: ç‰¹æ®Šå­—ç¬¦æ³¨å…¥
**å½±å“**: SQL æ³¨å…¥æˆ–è„šæœ¬æ‰§è¡Œé”™è¯¯
**å¯¹ç­–**:
- SQL è½¬ä¹‰ï¼ˆå•å¼•å· `'` â†’ `''`ï¼‰
- è€ƒè™‘ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
- è¾“å…¥éªŒè¯

### é£é™©5: æ€§èƒ½å½±å“
**å½±å“**: Claude Code å¯åŠ¨/åœæ­¢ç¼“æ…¢
**å¯¹ç­–**:
- æ€§èƒ½æµ‹è¯•éªŒè¯
- ä¼˜åŒ–çƒ­ç‚¹ä»£ç 
- å¼‚æ­¥å¤„ç†éå…³é”®æ“ä½œ

---

## éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§
- [ ] æ‰€æœ‰ PRD éœ€æ±‚å·²å®ç°
- [ ] 4ç§ Hook äº‹ä»¶æ­£ç¡®å¤„ç†
- [ ] 7ä¸ªæŸ¥è¯¢å‘½ä»¤åŠŸèƒ½æ­£å¸¸
- [ ] æ•°æ®å¯¼å‡ºåŠŸèƒ½æ­£å¸¸
- [ ] å¼‚å¸¸æ¸…ç†åŠŸèƒ½æ­£å¸¸

### è´¨é‡æ ‡å‡†
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡ç‡ 100%
- [ ] é›†æˆæµ‹è¯•é€šè¿‡ç‡ 100%
- [ ] æ€§èƒ½æµ‹è¯•è¾¾æ ‡
- [ ] æ—  shellcheck è­¦å‘Š
- [ ] ä»£ç æ³¨é‡Šå®Œæ•´

### æ–‡æ¡£å®Œæ•´æ€§
- [ ] README.md æ¸…æ™°æ˜“æ‡‚
- [ ] INSTALL.md æ­¥éª¤å®Œæ•´
- [ ] ä»£ç æ³¨é‡Šè¯¦ç»†
- [ ] ç¤ºä¾‹é…ç½®æ­£ç¡®

### ç”¨æˆ·ä½“éªŒ
- [ ] å®‰è£…è¿‡ç¨‹é¡ºç•…
- [ ] é”™è¯¯æç¤ºå‹å¥½
- [ ] é€šçŸ¥ä¿¡æ¯æ¸…æ™°
- [ ] æŸ¥è¯¢è¾“å‡ºç¾è§‚

---

## åç»­è¿­ä»£è®¡åˆ’

### Phase 1 (v1.1) - è·¨å¹³å°æ”¯æŒ
- [ ] æ”¯æŒ Linux é€šçŸ¥ç³»ç»Ÿ (notify-send)
- [ ] æ”¯æŒ Windows (PowerShell + Toast é€šçŸ¥)
- [ ] Web ç•Œé¢æŸ¥çœ‹ç»Ÿè®¡
- [ ] æ•°æ®å¯è§†åŒ–ï¼ˆå›¾è¡¨ï¼‰

### Phase 2 (v1.2) - é«˜çº§åŠŸèƒ½
- [ ] äº‘ç«¯åŒæ­¥ï¼ˆå¯é€‰ï¼‰
- [ ] å¤šè®¾å¤‡æ”¯æŒ
- [ ] RESTful API æ¥å£
- [ ] æ•°æ®å¤‡ä»½ä¸æ¢å¤

### Phase 3 (v2.0) - æ™ºèƒ½åŒ–
- [ ] AI åˆ†æä½¿ç”¨æ¨¡å¼
- [ ] æ™ºèƒ½æé†’ï¼ˆé•¿æ—¶é—´è¿è¡Œè­¦å‘Šï¼‰
- [ ] é¡¹ç›®æ—¶é—´ç»Ÿè®¡æŠ¥å‘Š
- [ ] å›¢é˜Ÿåä½œåŠŸèƒ½ï¼ˆå¤šç”¨æˆ·ï¼‰

---

## é™„å½•

### A. å¼€å‘ç¯å¢ƒè¦æ±‚
- macOS 10.15+
- Bash 3.2+
- SQLite 3.x
- Python 3.x (ç”¨äº install.sh è‡ªåŠ¨é…ç½® Hooks)
- Claude Code (æœ€æ–°ç‰ˆæœ¬)
- terminal-notifier (æ¨èï¼Œå¯é€šè¿‡ brew install terminal-notifier å®‰è£…)

### B. ä¾èµ–å·¥å…·
- `sqlite3`: æ•°æ®åº“ç®¡ç†ï¼ˆå¿…éœ€ï¼‰
- `terminal-notifier`: macOS é€šçŸ¥ï¼ˆæ¨èï¼Œæ¯” osascript æ›´å¯é ï¼‰
- `osascript`: macOS é€šçŸ¥ï¼ˆå¤‡é€‰ï¼‰
- `jq`: JSON å¤„ç†ï¼ˆç”¨äºè§£æ Hook è¾“å…¥å’Œ exportï¼‰ï¼ˆå¿…éœ€ï¼‰
- `python3`: è‡ªåŠ¨é…ç½® Hooks åˆ° settings.jsonï¼ˆå¿…éœ€ï¼‰
- `launchctl`: å®ˆæŠ¤è¿›ç¨‹ç®¡ç†ï¼ˆå¯é€‰ï¼‰

### C. å‚è€ƒèµ„æ–™
- [SQLite Documentation](https://www.sqlite.org/docs.html)
- [Bash Shell Scripting Guide](https://www.gnu.org/software/bash/manual/)
- [macOS LaunchAgent Guide](https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html)
- [AppleScript Language Guide](https://developer.apple.com/library/archive/documentation/AppleScript/Conceptual/AppleScriptLangGuide/)

---

**æ–‡æ¡£ç»“æŸ**
